{% extends 'base.html.twig' %}

{% block title %}Тест AI{% endblock %}

{% block body %}
<div style="max-width: 800px; margin: 50px auto; padding: 20px;">
    <h1>Тестирование AI</h1>
    
    <form id="aiForm">
        <div style="margin-bottom: 20px;">
            <label for="message" style="display: block; margin-bottom: 5px;">Ваше сообщение:</label>
            <textarea 
                id="message" 
                rows="5" 
                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                placeholder="Введите сообщение для AI..."
                required
            ></textarea>
        </div>
        
        <button type="submit" id="submitBtn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Отправить
        </button>
    </form>

    <div id="loader" style="display: none; margin-top: 20px; text-align: center;">
        <div style="display: inline-block; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
    </div>

    <div id="error" style="display: none; margin-top: 20px; padding: 15px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; color: #721c24;">
        <strong>Ошибка:</strong> <span id="errorText"></span>
    </div>

    <div id="response" style="display: none; margin-top: 20px; padding: 15px; background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px;">
        <strong>Ответ AI:</strong>
        <div id="responseText" style="margin-top: 10px; white-space: pre-wrap;"></div>
    </div>
</div>

<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
document.getElementById('aiForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const message = document.getElementById('message').value;
    const loader = document.getElementById('loader');
    const error = document.getElementById('error');
    const response = document.getElementById('response');
    const submitBtn = document.getElementById('submitBtn');
    
    loader.style.display = 'block';
    error.style.display = 'none';
    response.style.display = 'none';
    submitBtn.disabled = true;
    
    try {
        const res = await fetch('/test-ai/send', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });
        
        const data = await res.json();
        
        if (data.success) {
            document.getElementById('responseText').textContent = data.response;
            response.style.display = 'block';
        } else {
            document.getElementById('errorText').textContent = data.error;
            error.style.display = 'block';
        }
    } catch (err) {
        document.getElementById('errorText').textContent = err.message;
        error.style.display = 'block';
    } finally {
        loader.style.display = 'none';
        submitBtn.disabled = false;
    }
});
</script>
{% endblock %}


